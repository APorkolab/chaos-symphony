<div class="container mx-auto p-4">
  <h1 class="text-3xl font-bold mb-6">Order Management</h1>

  <!-- Create Order Section -->
  <div class="bg-gray-800 p-4 rounded-lg shadow-md mb-8">
    <h2 class="text-xl font-semibold mb-4">Create New Order</h2>
    <div class="flex items-center space-x-4">
      <input
        type="number"
        [(ngModel)]="newOrderAmount"
        class="bg-gray-700 text-white p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        placeholder="Enter amount">
      <button
        (click)="createOrder()"
        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300">
        Submit Order
      </button>
    </div>
  </div>

  <!-- Orders Display Section -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

    <!-- Orders List -->
    <div class="md:col-span-2 bg-gray-800 p-4 rounded-lg shadow-md">
      <h2 class="text-xl font-semibold mb-4">All Orders</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full text-left">
          <thead class="bg-gray-700">
            <tr>
              <th class="p-3">Order ID</th>
              <th class="p-3">Status</th>
              <th class="p-3">Total</th>
              <th class="p-3">Created At</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of orders$ | async"
                (click)="selectOrder(order)"
                class="border-b border-gray-700 hover:bg-gray-700 cursor-pointer">
              <td class="p-3 font-mono text-sm">{{ order.id }}</td>
              <td class="p-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full" [ngClass]="statusColors[order.status]">
                  {{ order.status }}
                </span>
              </td>
              <td class="p-3">{{ order.total | number }} HUF</td>
              <td class="p-3">{{ order.createdAt | date:'medium' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Selected Order Timeline -->
    <div class="bg-gray-800 p-4 rounded-lg shadow-md">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Order Timeline</h2>
        <button
          title="Time-travel replay not implemented"
          disabled
          class="bg-gray-600 text-gray-400 font-bold py-2 px-4 rounded-md cursor-not-allowed">
          Replay
        </button>
      </div>
      <div *ngIf="selectedOrderHistory$ | async as selectedOrder; else noOrderSelected">
        <p class="mb-2"><span class="font-bold">ID:</span> <span class="font-mono text-sm">{{ selectedOrder.id }}</span></p>
        <p class="mb-4"><span class="font-bold">Total:</span> {{ selectedOrder.total | number }} HUF</p>

        <!-- Timeline visualization -->
        <div class="relative border-l-2 border-blue-500 ml-3 mt-4">
          <div *ngFor="let event of selectedOrder.history; let i = index" class="mb-8 ml-6">
            <span class="absolute -left-3.5 flex items-center justify-center w-6 h-6 bg-blue-500 rounded-full ring-8 ring-gray-800">
              <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
            </span>
            <h3 class="flex items-center mb-1 text-lg font-semibold text-white">
              {{ event.status }}
            </h3>
            <time class="block mb-2 text-sm font-normal leading-none text-gray-400">
              {{ event.timestamp | date:'mediumTime' }}
            </time>
          </div>
        </div>
      </div>
      <ng-template #noOrderSelected>
        <p class="text-gray-400">Select an order to see its history.</p>
      </ng-template>
    </div>
  </div>
</div>
