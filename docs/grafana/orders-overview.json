{
  "id": null,
  "uid": "chaos-symphony-orders",
  "title": "Chaos Symphony – Orders Overview",
  "tags": ["chaos-symphony", "orders", "micrometer"],
  "timezone": "",
  "schemaVersion": 39,
  "version": 1,
  "refresh": "10s",
  "panels": [
    {
      "type": "row",
      "title": "At-a-glance (last 24h)",
      "gridPos": {"x": 0, "y": 0, "w": 24, "h": 1},
      "collapsed": false,
      "panels": []
    },
    {
      "type": "stat",
      "title": "Orders Started (24h)",
      "gridPos": {"x": 0, "y": 1, "w": 6, "h": 4},
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "options": {
        "reduceOptions": {"calcs": ["last"], "fields": "", "values": false},
        "orientation": "auto",
        "textMode": "value",
        "colorMode": "value"
      },
      "targets": [
        {
          "expr": "sum(increase(orders_started_total[24h]))",
          "legendFormat": "started",
          "refId": "A"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Orders Succeeded (24h)",
      "gridPos": {"x": 6, "y": 1, "w": 6, "h": 4},
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "options": {
        "reduceOptions": {"calcs": ["last"], "fields": "", "values": false}
      },
      "targets": [
        {
          "expr": "sum(increase(orders_succeeded_total[24h]))",
          "legendFormat": "succeeded",
          "refId": "A"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Orders Failed (24h)",
      "gridPos": {"x": 12, "y": 1, "w": 6, "h": 4},
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "options": {
        "reduceOptions": {"calcs": ["last"], "fields": "", "values": false}
      },
      "targets": [
        {
          "expr": "sum(increase(orders_failed_total[24h]))",
          "legendFormat": "failed",
          "refId": "A"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Success Rate (24h)",
      "gridPos": {"x": 18, "y": 1, "w": 6, "h": 4},
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "options": {
        "reduceOptions": {"calcs": ["last"], "fields": "", "values": false},
        "colorMode": "value",
        "graphMode": "none",
        "text": {}
      },
      "fieldConfig": {
        "defaults": {"unit": "percent", "decimals": 1, "min": 0, "max": 100}
      },
      "targets": [
        {
          "expr": "100 * sum(increase(orders_succeeded_total[24h])) / clamp_min(sum(increase(orders_succeeded_total[24h])) + sum(increase(orders_failed_total[24h])), 1)",
          "legendFormat": "success %",
          "refId": "A"
        }
      ]
    },

    {
      "type": "row",
      "title": "Throughput (rate)",
      "gridPos": {"x": 0, "y": 5, "w": 24, "h": 1},
      "collapsed": false,
      "panels": []
    },
    {
      "type": "timeseries",
      "title": "Orders per second (global)",
      "gridPos": {"x": 0, "y": 6, "w": 24, "h": 9},
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "fieldConfig": {"defaults": {"unit": "ops"}, "overrides": []},
      "options": {"legend": {"displayMode": "table", "placement": "right"}},
      "targets": [
        {
          "expr": "sum(rate(orders_started_total[$__rate_interval]))",
          "legendFormat": "started r/s",
          "refId": "A"
        },
        {
          "expr": "sum(rate(orders_succeeded_total[$__rate_interval]))",
          "legendFormat": "succeeded r/s",
          "refId": "B"
        },
        {
          "expr": "sum(rate(orders_failed_total[$__rate_interval]))",
          "legendFormat": "failed r/s",
          "refId": "C"
        }
      ]
    },

    {
      "type": "row",
      "title": "Quality split",
      "gridPos": {"x": 0, "y": 15, "w": 24, "h": 1},
      "collapsed": false,
      "panels": []
    },
    {
      "type": "bargauge",
      "title": "Last 15m: Success vs Failed",
      "gridPos": {"x": 0, "y": 16, "w": 12, "h": 7},
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "fieldConfig": {"defaults": {"min": 0}},
      "targets": [
        {
          "expr": "sum(increase(orders_succeeded_total[15m]))",
          "legendFormat": "succeeded",
          "refId": "A"
        },
        {
          "expr": "sum(increase(orders_failed_total[15m]))",
          "legendFormat": "failed",
          "refId": "B"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Success rate (%) – last 1h",
      "gridPos": {"x": 12, "y": 16, "w": 12, "h": 7},
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "fieldConfig": {
        "defaults": {"unit": "percent", "decimals": 1, "min": 0, "max": 100}
      },
      "targets": [
        {
          "expr": "100 * sum(rate(orders_succeeded_total[$__rate_interval])) / clamp_min(sum(rate(orders_succeeded_total[$__rate_interval]) + rate(orders_failed_total[$__rate_interval])), 1e-9)",
          "legendFormat": "success %",
          "refId": "A"
        }
      ]
    },

    {
      "type": "row",
      "title": "Per service (if label `app` is set)",
      "gridPos": {"x": 0, "y": 23, "w": 24, "h": 1},
      "collapsed": false,
      "panels": []
    },
    {
      "type": "timeseries",
      "title": "Started by app (rate)",
      "gridPos": {"x": 0, "y": 24, "w": 8, "h": 8},
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "targets": [
        {
          "expr": "sum by (app) (rate(orders_started_total[$__rate_interval]))",
          "legendFormat": "{{app}}",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Succeeded by app (rate)",
      "gridPos": {"x": 8, "y": 24, "w": 8, "h": 8},
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "targets": [
        {
          "expr": "sum by (app) (rate(orders_succeeded_total[$__rate_interval]))",
          "legendFormat": "{{app}}",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Failed by app (rate)",
      "gridPos": {"x": 16, "y": 24, "w": 8, "h": 8},
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "targets": [
        {
          "expr": "sum by (app) (rate(orders_failed_total[$__rate_interval]))",
          "legendFormat": "{{app}}",
          "refId": "A"
        }
      ]
    }
  ],
  "templating": {
    "list": [
      {
        "name": "DS_PROMETHEUS",
        "type": "datasource",
        "query": "prometheus",
        "refresh": 1,
        "hide": 0
      }
    ]
  },
  "time": {"from": "now-24h", "to": "now"},
  "timepicker": {"refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m"]}
}
